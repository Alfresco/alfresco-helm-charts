---
suite: ATS kubernetes service tests
templates:
  - deployment-filestore.yaml
  - deployment-imagemagick.yaml
  - deployment-libreoffice.yaml
  - deployment-pdfrenderer.yaml
  - deployment-tika.yaml
  - deployment-transform-misc.yaml
  - deployment-transform-router.yaml
  - svc-filestore.yaml
  - svc-imagemagick.yaml
  - svc-libreoffice.yaml
  - svc-pdfrenderer.yaml
  - svc-tika.yaml
  - svc-transform-misc.yaml
  - svc-transform-router.yaml
  - config-filestore.yaml
  - config-imagemagick.yaml
  - config-libreoffice.yaml
  - config-pdfrenderer.yaml
  - config-tika.yaml
  - config-transform-misc.yaml
  - config-transform-router.yaml
  - secret-messagebroker.yaml


tests:
  - it: should render a service with matching pods
    values: &testvalues
      - values/test_values.yaml
    asserts:
      - isSubset:
          path: spec.template.metadata.labels
          content: &trouter_labels
            app.kubernetes.io/name: transform-router
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-transform-router.yaml
      - isSubset:
          path: spec.selector
          content: *trouter_labels
        template: svc-transform-router.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &sfs_labels
            app.kubernetes.io/name: filestore
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-filestore.yaml
      - isSubset:
          path: spec.selector
          content: *sfs_labels
        template: svc-filestore.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &im_labels
            app.kubernetes.io/name: imagemagick
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-imagemagick.yaml
      - isSubset:
          path: spec.selector
          content: *im_labels
        template: svc-imagemagick.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &lo_labels
            app.kubernetes.io/name: libreoffice
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-libreoffice.yaml
      - isSubset:
          path: spec.selector
          content: *lo_labels
        template: svc-libreoffice.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &pdf_labels
            app.kubernetes.io/name: pdfrenderer
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-pdfrenderer.yaml
      - isSubset:
          path: spec.selector
          content: *pdf_labels
        template: svc-pdfrenderer.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &tika_labels
            app.kubernetes.io/name: tika
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-tika.yaml
      - isSubset:
          path: spec.selector
          content: *tika_labels
        template: svc-tika.yaml
      - isSubset:
          path: spec.template.metadata.labels
          content: &misc_labels
            app.kubernetes.io/name: transform-misc
            app.kubernetes.io/instance: RELEASE-NAME
        template: deployment-transform-misc.yaml
      - isSubset:
          path: spec.selector
          content: *misc_labels
        template: svc-transform-misc.yaml
