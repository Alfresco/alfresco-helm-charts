{{- if gt .Values.replicaCount 1 -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "alfresco-share.custom-application-context.name" . }}
  labels:
    {{- include "alfresco-share.labels" . | nindent 4 }}
data:
  custom-slingshot-application-context.xml: |-
    <?xml version='1.0' encoding='UTF-8'?>
    <beans xmlns="http://www.springframework.org/schema/beans"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:hz="http://www.hazelcast.com/schema/spring"
          xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                    http://www.hazelcast.com/schema/spring
                    http://www.hazelcast.com/schema/spring/hazelcast-spring-2.4.xsd">
      <hz:topic id="topic" instance-ref="webframework.cluster.slingshot" name="slingshot-topic"/>
      <hz:hazelcast id="webframework.cluster.slingshot">
          <hz:config>
            <hz:group name="slingshot" password="alfresco"/>
            <hz:network port="5801" port-auto-increment="true">
                <hz:join>
                  <hz:kubernetes enabled="false">
                    <namespace>{{ .Release.Namespace }}</namespace>
                    <service-name>{{ template "alfresco-share.service-hz.name" . }}</service-name>
                  </hz:kubernetes>
                  <hz:tcp-ip enabled="false" />
                </hz:join>
                <hz:interfaces enabled="false">
                  <hz:interface>192.168.1.*</hz:interface>
                </hz:interfaces>
            </hz:network>
          </hz:config>
      </hz:hazelcast>
      <bean id="webframework.cluster.clusterservice" class="org.alfresco.web.site.ClusterTopicService" init-method="init">
          <property name="hazelcastInstance" ref="webframework.cluster.slingshot" />
          <property name="hazelcastTopicName"><value>slingshot-topic</value></property>
      </bean>

    </beans>
{{- end -}}
