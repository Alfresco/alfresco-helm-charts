<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(2)) > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(3) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/alfresco-helm-charts/assets/js/vendor/lunr.min.js"></script> <script src="/alfresco-helm-charts/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Custom keystores | Alfresco Helm Charts Documentation</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Custom keystores" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for the Alfresco component Helm Charts" /> <meta property="og:description" content="User documentation for the Alfresco component Helm Charts" /> <link rel="canonical" href="https://alfresco.github.io/alfresco-helm-charts/charts/alfresco-repository/docs/keystores.html" /> <meta property="og:url" content="https://alfresco.github.io/alfresco-helm-charts/charts/alfresco-repository/docs/keystores.html" /> <meta property="og:site_name" content="Alfresco Helm Charts Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Custom keystores" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for the Alfresco component Helm Charts","headline":"Custom keystores","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://alfresco.github.io/alfresco-helm-charts/docs/images/hyland-alfresco-logos.png"}},"url":"https://alfresco.github.io/alfresco-helm-charts/charts/alfresco-repository/docs/keystores.html"}</script> <!-- End Jekyll SEO tag --> <style> @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap') </style> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/alfresco-helm-charts/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Alfresco Helm Charts Documentation"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/alfresco-helm-charts/index.html" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/docs/build-your-own-charts.html" class="nav-list-link">Build your own charts</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Charts Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/reference.html" class="nav-list-link">Charts Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/activemq/README.html" class="nav-list-link">activemq</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-activiti/README.html" class="nav-list-link">alfresco-activiti</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-activiti-admin/README.html" class="nav-list-link">alfresco-activiti-admin</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-adf-app/README.html" class="nav-list-link">alfresco-adf-app</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-ai-transformer/README.html" class="nav-list-link">alfresco-ai-transformer</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-common/README.html" class="nav-list-link">alfresco-common</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-connector-ms365/README.html" class="nav-list-link">alfresco-connector-ms365</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-connector-msteams/README.html" class="nav-list-link">alfresco-connector-msteams</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-service/charts/alfresco-insight-zeppelin/README.html" class="nav-list-link">alfresco-insight-zeppelin</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-repository/README.html" class="nav-list-link">alfresco-repository</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-enterprise/README.html" class="nav-list-link">alfresco-search-enterprise</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-service/README.html" class="nav-list-link">alfresco-search-service</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-share/README.html" class="nav-list-link">alfresco-share</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-sync-service/README.html" class="nav-list-link">alfresco-sync-service</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-transform-service/README.html" class="nav-list-link">alfresco-transform-service</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Guides category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/" class="nav-list-link">Guides</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Alfresco Transform Service category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/alfresco-transform-service.html" class="nav-list-link">Alfresco Transform Service</a><ul class="nav-list"><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-transform-service/docs/autoscaling.html" class="nav-list-link">Autoscaling</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Process Services category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/alfresco-process.html" class="nav-list-link">Process Services</a><ul class="nav-list"><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-activiti/docs/databases-configuration.html" class="nav-list-link">Database configuration</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-activiti/docs/elasticsearch-configuration.html" class="nav-list-link">Index configuration</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Repository category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/alfresco-repository.html" class="nav-list-link">Repository</a><ul class="nav-list"><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/autoscaling.html" class="nav-list-link">Autoscaling</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/keystores.html" class="nav-list-link">Custom keystores</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/email.html" class="nav-list-link">Email features</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/enterprise-license.html" class="nav-list-link">Enterprise license</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/repository-properties.html" class="nav-list-link">Global properties</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/subsystems.html" class="nav-list-link">Subsystems</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Alfresco Helm Charts Documentation" aria-label="Search Alfresco Helm Charts Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://docs.alfresco.com/" class="site-button" target="_blank" rel="noopener noreferrer" > Docs </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Alfresco/alfresco-helm-charts" class="site-button" target="_blank" rel="noopener noreferrer" > GitHub Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/alfresco-helm-charts/docs/guides/">Guides</a></li> <li class="breadcrumb-nav-list-item"><a href="/alfresco-helm-charts/docs/guides/alfresco-repository.html">Repository</a></li> <li class="breadcrumb-nav-list-item"><span>Custom keystores</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="using-custom-keystore"> <a href="#using-custom-keystore" class="anchor-heading" aria-labelledby="using-custom-keystore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using custom keystore </h1> <p>Alfresco uses a set of keystores for different purposes. Among others thing keystores can be used for metadata encryption or traffic encryption.</p> <p>The alfresco-content-repository image comes with a keystore which contains a single security key. That key is primarily used for metadata encryption and it required when the repository starts up. In production environment it is recommended to use a custom keystore rather than the one present in the image.</p> <p>One may also need to have additional keystores deployed, for instance to allow using TLS encryption for a service the repository provides using an x509 certificate. We describe below how to do both.</p> <h2 id="the-metadata-keystore"> <a href="#the-metadata-keystore" class="anchor-heading" aria-labelledby="the-metadata-keystore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The metadata keystore </h2> <p>This keystore is used for property encryption and needs to remain identical throughout the life of the repository. Losing this keystore or its passwords will result in a repository that cannot startup so it is absolutely crucial to to back them up in some safe place.</p> <p>First create a local keystore. It is recommended to use p12 containers nowadays and leverage AES algorithm:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>keytool <span class="nt">-genseckey</span> <span class="se">\</span>
  <span class="nt">-keystore</span> /path/to/keystore.p12
  <span class="nt">-storetype</span> PKCS12 <span class="se">\</span>
  <span class="nt">-storepass</span> secret <span class="nt">-keyalg</span> AES <span class="se">\</span>
  <span class="nt">-keysize</span> 256 <span class="se">\</span>
  <span class="nt">-alias</span> metadata
</code></pre></div></div> <p>Now we need to create a secret with from that keystore file and its password in the namespace where Alfresco will be deployed:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create secret generic repository-keystores <span class="se">\</span>
  <span class="nt">--from-file</span><span class="o">=</span>/path/to/keystore.p12 <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="s2">"ENC_METADATA_STOREPASS=secret"</span> <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="s2">"ENC_METADATA_KEYPASS=secret"</span>
</code></pre></div></div> <blockquote> <p>Note, unlike the older JCEKS format, PKCS12 do not allow having different passwords for the keystore and the key. so both variables need to be populated with the same value (the same one that was used whn generating the keystore using keytool (here “secret”).</p> </blockquote> <p>Once the secret is created in target namespace we need to let the chart know it needs to mount it and provide necessary options for the repository to access that keystore. To do so use the properties below:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">configuration</span><span class="pi">:</span>
  <span class="na">repository</span><span class="pi">:</span>
    <span class="na">existingSecrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repository-keystores</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">ENC_METADATA_STOREPASS</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repository-keystores</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">ENC_METADATA_KEYPASS</span>
<span class="na">environment</span><span class="pi">:</span>
  <span class="na">JAVA_OPTS</span><span class="pi">:</span> <span class="pi">&gt;-</span>
    <span class="s">-Dencryption.keystore.type=PKCS12</span>
    <span class="s">-Dencryption.cipherAlgorithm=AES/CBC/PKCS5Padding</span>
    <span class="s">-Dencryption.keyAlgorithm=AES</span>
    <span class="s">-Dencryption.keystore.location=/usr/local/tomcat/shared/classes/alfresco/extension/keystore/keystore.p12</span>
    <span class="s">-Dmetadata-keystore.aliases=metadata</span>
    <span class="s">-Dmetadata-keystore.metadata.algorithm=AES</span>
<span class="na">extraVolumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">keystore</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">repository-keystores</span>
<span class="na">extraVolumeMounts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">keystore</span>
    <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/local/tomcat/shared/classes/alfresco/extension/keystore</span>
</code></pre></div></div> <blockquote> <p>Note credentials are not passed directly using <code class="language-plaintext highlighter-rouge">environment.JAVA_OPTS</code> but secrets.</p> </blockquote> <h2 id="other-keystore"> <a href="#other-keystore" class="anchor-heading" aria-labelledby="other-keystore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other keystore </h2> <p>The same approach would work to deploy any keystore. Below example describes how to deploy a custom keystore (here for imaps configuration) together with the required option so the repository can use it.</p> <p>First let’s create a keysotre with a self-signed cert &amp; store it in a p12 file.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-new</span> <span class="nt">-newkey</span> rsa:2048 <span class="nt">-days</span> 365 <span class="nt">-nodes</span> <span class="nt">-x509</span> <span class="nt">-keyout</span> server.key <span class="nt">-out</span> server.crt
openssl pkcs12 <span class="nt">-export</span> <span class="nt">-in</span> server.crt <span class="nt">-inkey</span> server.key <span class="nt">-out</span> server.p12 <span class="nt">-name</span> localhost
keytool <span class="nt">-importkeystore</span> <span class="se">\</span>
        <span class="nt">-deststorepass</span> secret <span class="nt">-destkeypass</span> secret <span class="nt">-destkeystore</span> keystore.p12 <span class="nt">-deststoretype</span> PKCS12 <span class="se">\</span>
        <span class="nt">-srckeystore</span> server.p12 <span class="nt">-srcstoretype</span> PKCS12 <span class="nt">-srcstorepass</span> secret <span class="se">\</span>
        <span class="nt">-alias</span> localhost
</code></pre></div></div> <blockquote> <p>Java prefers working with PKCS12 containers generated using keytool so that’s why we generate 2 p12 files</p> </blockquote> <p>Then create a secret from this keystore file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create secret generic repository-keystores <span class="se">\</span>
  <span class="nt">--from-file</span><span class="o">=</span>keystore.p12 <span class="se">\</span>
</code></pre></div></div> <p>Now in order to make sure the repo can open the keystore we need to give the necessary credentials. We will pass credentials values as kubernetes secret keys’ values and their related java properties as their keys. For example in order to pass the property <code class="language-plaintext highlighter-rouge">javax.net.ssl.keyStorePassword=secret</code> we would create the secret as follow:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create secret generic kesystore-secret <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="nv">MYKEYSTORE_PASS</span><span class="o">=</span>secret
</code></pre></div></div> <blockquote> <p>credentials can be held in the same secret as the keystore itself.</p> </blockquote> <p>Now we need to reference these secrets and pass the non sensitive properties as <code class="language-plaintext highlighter-rouge">environment.JAVA_OPTS</code> when deploying the alfresco-repository chart:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">extraVolumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">keystore</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span> <span class="s">repository-keystores</span>
<span class="na">extraVolumeMounts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">keystore</span>
    <span class="na">readOnly</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/local/tomcat/shared/classes/alfresco/extension/keystore</span>
<span class="na">configuration</span><span class="pi">:</span>
  <span class="na">repository</span><span class="pi">:</span>
    <span class="na">existingSecrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kesystore-secret</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">javax.net.ssl.keyStorePassword</span>
        <span class="na">purpose</span><span class="pi">:</span> <span class="s">property:javax.net.ssl.keyStorePassword</span>
<span class="na">environment</span><span class="pi">:</span>
  <span class="na">JAVA_OPTS</span><span class="pi">:</span> <span class="pi">&gt;-</span>
    <span class="s">-Djavax.net.ssl.keyStore=/usr/local/tomcat/shared/classes/alfresco/extension/keystore/keystore.p12</span>
</code></pre></div></div> <p>This very same procdure can apply to other service which require a certification to enable traffic encryption.</p> </main> <hr> <footer> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Alfresco/alfresco-helm-charts/edit/main/./charts/alfresco-repository/docs/keystores.md" id="edit-this-page">Improve this page on GitHub</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
