<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/alfresco-helm-charts/assets/js/vendor/lunr.min.js"></script> <script src="/alfresco-helm-charts/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/alfresco-helm-charts/docs/images/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Autoscaling | Alfresco Jekyll Build tools</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Autoscaling" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation generator" /> <meta property="og:description" content="Documentation generator" /> <link rel="canonical" href="https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/charts/alfresco-repository/docs/autoscaling.html" /> <meta property="og:url" content="https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/charts/alfresco-repository/docs/autoscaling.html" /> <meta property="og:site_name" content="Alfresco Jekyll Build tools" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Autoscaling" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documentation generator","headline":"Autoscaling","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/docs/images/hyland-alfresco-logos.png"}},"url":"https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/charts/alfresco-repository/docs/autoscaling.html"}</script> <!-- End Jekyll SEO tag --> <style> @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap') </style> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/alfresco-helm-charts/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Alfresco Jekyll Build tools"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/alfresco-helm-charts/index.html" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/docs/build-your-own-charts.html" class="nav-list-link">Build your own charts</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Component Charts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/reference.html" class="nav-list-link">Component Charts</a><ul class="nav-list"></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Alfresco Jekyll Build tools" aria-label="Search Alfresco Jekyll Build tools" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://docs.alfresco.com/" class="site-button" target="_blank" rel="noopener noreferrer" > Docs </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Alfresco/alfresco-helm-charts" class="site-button" target="_blank" rel="noopener noreferrer" > GitHub Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/alfresco-helm-charts/docs/reference.html">Component Charts</a></li> <li class="breadcrumb-nav-list-item"><a href="">alfresco-repository</a></li> <li class="breadcrumb-nav-list-item"><span>Autoscaling</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="alfresco-repository-auto-scaling"> <a href="#alfresco-repository-auto-scaling" class="anchor-heading" aria-labelledby="alfresco-repository-auto-scaling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Alfresco repository auto scaling </h1> <p>This document describes auto scaling principles implemented in this Helm chart.</p> <p>This document do not explain how to setup Kubernetes worker nodes auto-scaling. That is a completely different topic which can be addressed in different ways and is up to the Kubernetes administrator.</p> <h2 id="horizontal-pod-auto-scaling"> <a href="#horizontal-pod-auto-scaling" class="anchor-heading" aria-labelledby="horizontal-pod-auto-scaling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Horizontal Pod Auto scaling </h2> <p>For general concepts about HPA please refer to <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">official Kubernetes documentation</a>.</p> <p>Repository pods auto scaling is disabled by default. If you want to enable it you need to use the additional value:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">autoscaling</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div> <p>The default configuration implemented in this chart aims at being able to cope with peak load or spare resources on low level of utilization while also minimizing the number of scaling events because changing the cluster topology means additional computation.</p> <h3 id="default-behaviour"> <a href="#default-behaviour" class="anchor-heading" aria-labelledby="default-behaviour"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Default behaviour: </h3> <p>Without any further configuration scaling would happen as follow:</p> <ul> <li>Cluster would spin up new pods every minute if the current average pods’ load is above 75% CPU usage during 30 seconds.</li> <li>Cluster would spin up no more than 2 pods or 50% more pods of the existing replicas (whichever is bigger) per minute.</li> <li>There would never be more than 3 replicas in the Replicaset</li> <li>There would never be less than 1 replicas in the Replicaset</li> <li>Cluster would remove one pod at most if the CPU load get consistently below 75% for 5 minutes.</li> <li>Cluster would kill pod only one after the other within a minute.</li> </ul> <blockquote> <p>CPU utilization/load is calculated with regards to the CPU resource request setting (<code class="language-plaintext highlighter-rouge">.resources.requests.cpu</code>) which is now set to 1 CPU by default.</p> </blockquote> <h3 id="customizing-auto-scaling"> <a href="#customizing-auto-scaling" class="anchor-heading" aria-labelledby="customizing-auto-scaling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Customizing auto scaling </h3> <p>The values and behaviour exposed above are defaults we think are sensible to start with. Of course they will not fit every single deployment/installation of Alfresco on Kubernetes.</p> <p>Below are ways to tweak the auto scaling behaviour for your own setup.</p> <h4 id="settings-the-cpu-resources-correctly"> <a href="#settings-the-cpu-resources-correctly" class="anchor-heading" aria-labelledby="settings-the-cpu-resources-correctly"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Settings the CPU resources correctly. </h4> <p>CPU Resources request is the basis of calculation for the cluster to trigger scaling events. It is then very important to make sure it is set appropriately before enabling auto scaling. Imagine you have a production Kubernetes cluster with large worker nodes (say 3 * 32 CPU nodes). Having CPU requests set to 2 would most likely make the cluster spin up new pods very quickly. Instead it would be better to ensure your repository pods have a sensible <code class="language-plaintext highlighter-rouge">.resources.requests.cpu</code> value set to say 8. Also you should note that the very same <code class="language-plaintext highlighter-rouge">.resources.requests.cpu</code> value is used by the Kubernetes scheduler, so setting it too high is not a good idea either. It should be set to a value which will allow pods to be scheduled on worker nodes alongside other pods.</p> <blockquote> <p>default <code class="language-plaintext highlighter-rouge">.resources.limits.cpu</code> is set to 4 CPU so you will also want to increase this value to something like 12.</p> </blockquote> <p>Just by setting a sensible <code class="language-plaintext highlighter-rouge">.resources.requests.cpu</code> the auto scaling behaviour would already make much more sense given the worker nodes’ size.</p> <h4 id="configuring-the-auto-scaling-behaviour"> <a href="#configuring-the-auto-scaling-behaviour" class="anchor-heading" aria-labelledby="configuring-the-auto-scaling-behaviour"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring the auto scaling behaviour </h4> <p>The <code class="language-plaintext highlighter-rouge">autoscaling.*</code> values below can be fined tuned. There a few things to take into account when changing those as explained:</p> <ul> <li><code class="language-plaintext highlighter-rouge">.minReplicas</code>: This parameter is used to limit the lowest number of replicas</li> <li><code class="language-plaintext highlighter-rouge">.maxReplicas</code>: This parameter is used to limit the highest number of replicas the more member the Hazelcast cluster has, the more chatty the cluster is. Keeping the cluster below 6 to 8 nodes seems a good target.</li> <li><code class="language-plaintext highlighter-rouge">.behavior.scaleUp.stabilizationWindowSeconds</code>: This parameter is used to avoid flapping replicasets. A very short peak load is not worth a scale up. So you surely want to avoid scaling without making sure the load has increased consistently and scale up needs to happen. That parameter tells for how long the load should be over target before the HPA controller decides to increase the number of replicas. The shorter this value, the more likely you are to spin up pods for short peak workload, so the pod could even be ready after the load is actually back to normal. Setting this too low when CPU resources requests is set to 1 is counter productive as it’s pretty easy to make 1 CPU busy.</li> <li><code class="language-plaintext highlighter-rouge">.behavior.scaleDown.stabilizationWindowSeconds</code>: This parameter is used in the same manner as for scale up events. One notable difference though is that scaling down has an immediate effect on the way the application handles the workload while scaling up is more expensive as pods need to startup before it can actually start handling requests. For that reason we think one should always be more cautious when brining the number of replica down. You probably want to avoid taking pods down too quickly if your workload is not very consistent.</li> <li>`.behavior.scaleUp.policies[]: <ul> <li><code class="language-plaintext highlighter-rouge">.periodSeconds</code>: The faster an individual repo pod is to startup (Tomcat complete startup) the lower this parameter can be. 60s appeared a good value for startup times around 90s. The lower this parameter the faster new pods can be spun up and the faster peak load can be handled.</li> <li><code class="language-plaintext highlighter-rouge">.type</code> &amp; <code class="language-plaintext highlighter-rouge">value</code>: For exact details on setting this part of the auto scaler policy check the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#scaling-policies">kubernetes doc</a>. Policies let you define the way you want to act upon scaling events. For scale up events, if you know your load peak are steep (but consistent) then you will want to scale the replicaset by more pods than if you load is growing more slowly.</li> </ul> </li> </ul> </main> <hr> <footer> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Alfresco/alfresco-helm-charts/edit/main/./charts/alfresco-repository/docs/autoscaling.md" id="edit-this-page">Improve this page on GitHub</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
