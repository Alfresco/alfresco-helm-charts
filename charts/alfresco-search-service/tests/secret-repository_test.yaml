---
suite: test repository secret
templates:
  - secret-repository.yaml
tests:
  - it: should render the shared secret from values
    values: &testvalues
      - values/test_values.yaml
    asserts:
      - equal:
          path: data.SOLR_ALFRESCO_SECURECOMMS_SECRET
          decodeBase64: true
          value: dummy

  - it: should not render a shared secret if securecomms is not set to "secret"
    values: *testvalues
    set:
      repository:
        securecomms: none
    asserts:
      - hasDocuments:
          count: 0

  - it: should not render a shared secret if securecomms is not set to "secret"
    values: *testvalues
    set:
      repository:
        securecomms: secret
        existingSecret:
          name: mysecret
    asserts:
      - hasDocuments:
          count: 0
