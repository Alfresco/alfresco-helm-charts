---
suite: test kibana deployment
templates:
  - kibana-deployment.yaml
tests:
  - it: should render kibana image with correct version
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: "kibana:8.17.0"

  - it: should render cpu and memory limits
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: 1
              memory: "1Gi"

  - it: should set kibana environment variables
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ELASTICSEARCH_HOSTS
            value: "http://RELEASE-NAME-elastic-es:9200"

  - it: should render with ci values
    values:
      - ../ci/default-values.yaml
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              cpu: "100m"
              memory: "256Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
