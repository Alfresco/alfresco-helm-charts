suite: test ai-transformer secrets
templates:
- secret-aws.yaml
tests:
- it: should have an empty secret rendered by default
  values: &testvalues
  - values/test_values.yaml
  asserts:
    - exists:
        path: data.AWS_ACCESS_KEY_ID
    - equal:
        path: data.AWS_ACCESS_KEY_ID
        value: null
    - equal:
        path: data.AWS_SECRET_ACCESS_KEY
        value: null
- it: should render secret based on values
  values: *testvalues
  set:
    aws:
      accessKeyId: SOMEID
      secretAccessKey: SOMEKEY
  asserts:
    - equal:
        path: data.AWS_ACCESS_KEY_ID
        value: SOMEID
    - equal:
        path: data.AWS_SECRET_ACCESS_KEY
        value: SOMEKEY
- it: should not render secrets
  values: *testvalues
  set:
    aws:
      existingSecret:
        name: aws-iam-user
  asserts:
    - hasDocuments:
        count: 0
