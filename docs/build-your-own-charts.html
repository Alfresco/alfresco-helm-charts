<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/alfresco-helm-charts/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/alfresco-helm-charts/assets/js/vendor/lunr.min.js"></script> <script src="/alfresco-helm-charts/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/alfresco-helm-charts/docs/images/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Build your own charts | Alfresco Helm Charts Documentation</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Build your own charts" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for the Alfresco component Helm Charts" /> <meta property="og:description" content="User documentation for the Alfresco component Helm Charts" /> <link rel="canonical" href="https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/docs/build-your-own-charts.html" /> <meta property="og:url" content="https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/docs/build-your-own-charts.html" /> <meta property="og:site_name" content="Alfresco Helm Charts Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Build your own charts" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for the Alfresco component Helm Charts","headline":"Build your own charts","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/docs/images/hyland-alfresco-logos.png"}},"url":"https://alfresco.github.io/alfresco-helm-charts/alfresco-helm-charts/docs/build-your-own-charts.html"}</script> <!-- End Jekyll SEO tag --> <style> @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap') </style> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/alfresco-helm-charts/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Alfresco Helm Charts Documentation"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/alfresco-helm-charts/index.html" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/docs/build-your-own-charts.html" class="nav-list-link">Build your own charts</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Charts Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/reference.html" class="nav-list-link">Charts Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/activemq/README.html" class="nav-list-link">activemq</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-activiti/README.html" class="nav-list-link">alfresco-activiti</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-activiti-admin/README.html" class="nav-list-link">alfresco-activiti-admin</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-adf-app/README.html" class="nav-list-link">alfresco-adf-app</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-ai-transformer/README.html" class="nav-list-link">alfresco-ai-transformer</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-common/README.html" class="nav-list-link">alfresco-common</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-connector-ms365/README.html" class="nav-list-link">alfresco-connector-ms365</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-connector-msteams/README.html" class="nav-list-link">alfresco-connector-msteams</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-service/charts/alfresco-insight-zeppelin/README.html" class="nav-list-link">alfresco-insight-zeppelin</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-repository/README.html" class="nav-list-link">alfresco-repository</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-enterprise/README.html" class="nav-list-link">alfresco-search-enterprise</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-search-service/README.html" class="nav-list-link">alfresco-search-service</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-share/README.html" class="nav-list-link">alfresco-share</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-sync-service/README.html" class="nav-list-link">alfresco-sync-service</a></li><li class="nav-list-item"><a href="/alfresco-helm-charts/charts/alfresco-transform-service/README.html" class="nav-list-link">alfresco-transform-service</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Guides category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/" class="nav-list-link">Guides</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Process Services category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/alfresco-process.html" class="nav-list-link">Process Services</a><ul class="nav-list"><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-activiti/docs/databases-configuration.html" class="nav-list-link">Database configuration</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-activiti/docs/elasticsearch-configuration.html" class="nav-list-link">Index configuration</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Repository category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/alfresco-helm-charts/docs/guides/alfresco-repository.html" class="nav-list-link">Repository</a><ul class="nav-list"><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/autoscaling.html" class="nav-list-link">Autoscaling</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/keystores.html" class="nav-list-link">Custom keystores</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/email.html" class="nav-list-link">Email features</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/enterprise-license.html" class="nav-list-link">Enterprise license</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/repository-properties.html" class="nav-list-link">Global properties</a> </li><li class="nav-list-item"> <a href="/alfresco-helm-charts/charts/alfresco-repository/docs/subsystems.html" class="nav-list-link">Subsystems</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Alfresco Helm Charts Documentation" aria-label="Search Alfresco Helm Charts Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://docs.alfresco.com/" class="site-button" target="_blank" rel="noopener noreferrer" > Docs </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/Alfresco/alfresco-helm-charts" class="site-button" target="_blank" rel="noopener noreferrer" > GitHub Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="building-your-content-platform-architecture-with-alfresco-charts"> <a href="#building-your-content-platform-architecture-with-alfresco-charts" class="anchor-heading" aria-labelledby="building-your-content-platform-architecture-with-alfresco-charts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building your Content platform architecture with Alfresco charts </h1> <h2 id="the-alfresco-common-library-chart"> <a href="#the-alfresco-common-library-chart" class="anchor-heading" aria-labelledby="the-alfresco-common-library-chart"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The alfresco-common library chart </h2> <p>Alfresco charts depend on a common library chart called <a href="/alfresco-helm-charts/charts/alfresco-common/README.html">alfresco-common</a>. This chart provides a set of <a href="https://helm.sh/docs/chart_template_guide/named_templates">named templates</a> one can use in order to build his own content platform chart.</p> <p>Named templates are reusable functions that can only return strings and always take a single argument, which eventually can be an object. For example the <a href="https://github.com/Alfresco/alfresco-helm-charts/blob/main/charts/alfresco-common/templates/_helpers-url.tpl">URL helper</a> file provides functions to extract various elements from a given URL. For example:</p> <ul> <li><code class="language-plaintext highlighter-rouge">{{ template "alfresco-common.url.scheme" "https://hub.alfresco.com/" }}</code> will return “https”</li> <li><code class="language-plaintext highlighter-rouge">{{ template "alfresco-common.url.port" "https://hub.alfresco.com/" }}</code> will return “443”</li> </ul> <p>Check out the dedicated Chart documentation to get a more comprehensive list of named templates the chart offers.</p> <h2 id="alfresco-components-charts"> <a href="#alfresco-components-charts" class="anchor-heading" aria-labelledby="alfresco-components-charts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Alfresco components charts </h2> <p>The individual Alfresco components’ chart are meant to be configurable and reusable. They do not provide a working system on their own and need to be either used from an “umbrella chart” or be given additional details about other components they interact with in order to actually deliver the service they are meant to deliver. For example the <code class="language-plaintext highlighter-rouge">alfresco-repository</code> chart needs to have a database to initialize its content repository.</p> <p>This document explains what are the options you can leverage to “pipe” an Alfresco chart with another or with an external service.</p> <h3 id="understanding-the-alfresco-content-platform"> <a href="#understanding-the-alfresco-content-platform" class="anchor-heading" aria-labelledby="understanding-the-alfresco-content-platform"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding the Alfresco Content platform </h3> <p>Before you begin, make sure you do understand the Alfresco Content platform and its components so you know exactly what you need or do not need.</p> <p>⚠️TODO: create chart diagram showing dependencies and level of dependencies</p> <h3 id="creating-your-alfresco-platform"> <a href="#creating-your-alfresco-platform" class="anchor-heading" aria-labelledby="creating-your-alfresco-platform"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating your Alfresco platform </h3> <p>There are numerous ways to create your own Alfresco deployment and the component charts hosted in this repository can be used as building blocks for this purpose. Depending on preferences you may want to use <a href="https://www.terraform.io/">Terraform</a>, <a href="https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/helmcharts/">Kustomize</a> or simply wrap the component charts into an “umbrella chart”.</p> <p>Here we’ll focus on the later option but the same configuration principles apply to other methods.</p> <p>In the example below we’ll go through the process of integrating an ACS content platform made of:</p> <ul> <li>Alfresco content repository</li> <li>A database that hosted outside of the kubernetes cluster</li> </ul> <blockquote> <p>Below example also present using an “umbrella” Helm chart but most of the same approach is applicable to other deployment method as explained above.</p> </blockquote> <h4 id="declaring-chart-as-dependency"> <a href="#declaring-chart-as-dependency" class="anchor-heading" aria-labelledby="declaring-chart-as-dependency"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Declaring chart as dependency </h4> <p><a href="https://helm.sh/docs/helm/helm_dependency/">Helm provides a mechanism to declare dependencies</a> and re-use existing charts.</p> <p>We’ll start by initializing a chart and declare the dependency to the <code class="language-plaintext highlighter-rouge">alfresco-repository</code> chart.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm create myecmplatform <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$_</span>
</code></pre></div></div> <p>Edit the <code class="language-plaintext highlighter-rouge">Chart.yaml</code> to give the chart a sensible description, a version and optionally specify the version of your content platform. Then declare the dependency as shown below:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dependencies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">alfresco-repository</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">0.1.0</span>
    <span class="na">repository</span><span class="pi">:</span> <span class="s">https://alfresco.github.io/alfresco-helm-charts/</span>
    <span class="na">alias</span><span class="pi">:</span> <span class="s">repo</span>
</code></pre></div></div> <blockquote> <p>In the example above we use <code class="language-plaintext highlighter-rouge">repo</code> as an alias so any value in our chart that lives under the <code class="language-plaintext highlighter-rouge">$.repo</code> YAML path will actually be passed to the <code class="language-plaintext highlighter-rouge">alfresco-repository</code> chart. In other words, values documented for the <code class="language-plaintext highlighter-rouge">alfresco-repository</code> chart such as <code class="language-plaintext highlighter-rouge">replicaCount</code> will be used from your chart as <code class="language-plaintext highlighter-rouge">repo.replicaCount</code>.</p> </blockquote> <h4 id="configuring-the-chart"> <a href="#configuring-the-chart" class="anchor-heading" aria-labelledby="configuring-the-chart"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring the chart </h4> <p>Now we need to let the repository where it can find its database. When it comes to configuring a chart so it can reach another component of the platform, the Alfresco component charts lets you do that in 2 different ways:</p> <ul> <li>Using regular values</li> <li>Using kubernetes config resources (configMap or secret)</li> </ul> <h4 id="configuring-database-using-values"> <a href="#configuring-database-using-values" class="anchor-heading" aria-labelledby="configuring-database-using-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring database using values </h4> <p>First thing to do is to check the chart <a href="/alfresco-helm-charts/charts/alfresco-repository/README.html">values documentation</a>. There, we can see the database configuration can be done using the <code class="language-plaintext highlighter-rouge">configuration.db</code> element in our <code class="language-plaintext highlighter-rouge">values.yaml</code> file as shown below:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">repo</span><span class="pi">:</span>
  <span class="na">configuration</span><span class="pi">:</span>
    <span class="na">db</span><span class="pi">:</span>
      <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:postgresql//db.ecm.infra.local/alfresco</span>
      <span class="na">username</span><span class="pi">:</span> <span class="s">ecmdaouser</span>
      <span class="na">password</span><span class="pi">:</span> <span class="s">ecmdaopass</span>
</code></pre></div></div> <h4 id="configuring-database-using-kubernetes-resources"> <a href="#configuring-database-using-kubernetes-resources" class="anchor-heading" aria-labelledby="configuring-database-using-kubernetes-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring database using kubernetes resources </h4> <p>When using kubernetes resources we will want to differentiate configuration details which are sensitive and which are not. The former will be stored in <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">configMap</a>, while the later would use <a href="https://kubernetes.io/fr/docs/concepts/configuration/secret/">secret</a>.</p> <p>That means here we’ll use a configMap to set store the database URL while credentials would live in a secret. That concretely translate into the following kubernetes resources:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">myEcmReleaseName</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">Alfresco-content-platform</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.0.0</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ecm-database-location</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">myecm</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">MY_ECM_DB_URL</span><span class="pi">:</span> <span class="s">jdbc:postgresql://db.ecm.infra.local/alfresco</span>
  <span class="na">MY_ECM_DB_DRIVER</span><span class="pi">:</span> <span class="s">org.postgresql.Driver</span>
</code></pre></div></div> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">myEcmReleaseName</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">Alfresco-content-platform</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s">1.0.0</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ecm-database-credentials</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">myecm</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">MY_ECM_DB_USER</span><span class="pi">:</span> <span class="s">c2NvdHQ=</span>
  <span class="na">MY_ECM_DB_PASS</span><span class="pi">:</span> <span class="s">dGlnZXI=</span>
</code></pre></div></div> <blockquote> <p>For example, if you’re creating this ConfigMap using a wrapping Helm chart, you can reuse a templating function provided by the <a href="https://github.com/Alfresco/alfresco-helm-charts/blob/main/charts/alfresco-repository/templates/_helpers-database.tpl">alfresco-repository</a> chart <code class="language-plaintext highlighter-rouge">alfresco-repository.db.cm</code></p> </blockquote> <p>Now we need to let the <code class="language-plaintext highlighter-rouge">alfresco-repository</code> chart where to find this:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">repo</span><span class="pi">:</span>
  <span class="na">configuration</span><span class="pi">:</span>
    <span class="na">db</span><span class="pi">:</span>
      <span class="na">existingConfigMap</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">ecm-database-location</span>
      <span class="na">keys</span><span class="pi">:</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">MY_ECM_DB_URL</span>
        <span class="na">driver</span><span class="pi">:</span> <span class="s">MY_ECM_DB_DRIVER</span>
      <span class="na">existingSecret</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">ecm-database-credentials</span>
      <span class="na">keys</span><span class="pi">:</span>
        <span class="na">username</span><span class="pi">:</span> <span class="s">MY_ECM_DB_USER</span>
        <span class="na">password</span><span class="pi">:</span> <span class="s">MY_ECM_DB_PASS</span>
</code></pre></div></div> <blockquote> <p>If you used the templating function mentioned above and provided by the subchart the keys would be different than the ones mentioned in the example above. Actually the function would render teh default keys so it’s not needed to set them.</p> </blockquote> </main> <hr> <footer> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Alfresco/alfresco-helm-charts/edit/main/./docs/build-your-own-charts.md" id="edit-this-page">Improve this page on GitHub</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
